<!DOCTYPE html>
<html>
<head>
<title>Admin Home Page</title>
	<!-- <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script> -->
    <!-- <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>	 -->
	<!--Icons-->
	<script src="js/lumino.glyphs.js"></script>
	<!-- <script type="text/javascript" src="https://kit.glyphs.co/3dj913.js"></script> -->
	 <!-- include the Tools -->
	<!-- <script type="text/javascript" src="js/jquery.tools.min.js"></script> -->
	<script src="https://www.gstatic.com/firebasejs/3.5.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.5.0/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.5.0/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.5.0/firebase-messaging.js"></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
	<link href="css/style2.css" rel="stylesheet" type="text/css">
	<!-- <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script> -->
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>		
		<link href="css/style2.css" rel="stylesheet" type="text/css">	
		<link rel="stylesheet" type="text/css" href="css/jquery.datetimepicker.css"/>
		<!-- include the Tools -->
	<script type="text/javascript" src="js/jquery.tools.min.js"></script>	
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/jquery.datetimepicker.js"></script>
	<script src="js/bootstrap.min.js"></script>	
	<script src="js/b00tstrap.js"></script>	
	
	
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/datepicker3.css" rel="stylesheet">
	<link href="css/styles.css" rel="stylesheet">
	<link rel="shortcut icon" href="favicon.ico">
	<!-- <script src="jquery.collapse.js"></script> -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
</head>
<body>

	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#"><span>MYCAPE.IO</span></a>
				<ul class="user-menu">
					<li class="dropdown pull-right">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> <span id="firstName_span"></span> <span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li class="active"><a href="#"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Global</a></li>
							<li><a href="#"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Local Route</a></li>							
							<li><a href="#"><svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"></use></svg> Logout</a></li>
						</ul>
					</li>
				</ul>
			</div>
							
		</div><!-- /.container-fluid -->
	</nav>
	
	<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
		<form role="search">
			<div class="form-group">
				<input type="text" class="form-control" placeholder="Search">
			</div>
		</form>
		<ul class="nav menu">
			<!-- <li class="active"><a href="profile.html"> Profile</a></li> -->
			<li><a href="GlobalSetting.html"><svg class="glyph stroked app window with content"><use xlink:href="#stroked-app-window-with-content"/></svg> Global Settings</a></li>
			<li><a href="RouteSetting.html"><svg class="glyph stroked app-window"><use xlink:href="#stroked-app-window"></use></svg> Route Settings</a></li>
			<li><a href="AddRoute.html"><svg class="glyph stroked plus sign"><use xlink:href="#stroked-plus-sign"/></svg> Add Route</a></li>
			<li><a href="FlightLevel.html"><svg class="glyph stroked table"><use xlink:href="#stroked-table"/></svg> Flight Level</a></li>							
			<li><a href="dashboard.html"><svg class="glyph stroked calendar"><use xlink:href="#stroked-calendar"></use></svg> Dashboard</a></li>
			<li class="active"><a href="BookingTracker.html"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Tracker</a></li>
			<li class="parent ">
				<a href="#">
					<span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span> Private Beta Options 
				</a>
				<ul class="children collapse" id="sub-item-1">
					<li>
						<a class="" href="AddFlightOnPB.html">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Add Booking
						</a>
					</li>
					<li>
						<a class="" href="UpdateFlightOnPB.html">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Update Booking
						</a>
					</li>
					<li>
						<a class="" href="DeleteFlightOnPB.html">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Delete Booking
						</a>
					</li>
				</ul>
			</li>
			<!-- <li><a href="icons.html"><svg class="glyph stroked star"><use xlink:href="#stroked-star"></use></svg> Icons</a></li> -->
			<!-- <li class="parent "> 
				<a href="#">
					<span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span> Dropdown 
				</a>
				<ul class="children collapse" id="sub-item-1">
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Sub Item 1
						</a>
					</li>
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Sub Item 2
						</a>
					</li>
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Sub Item 3
						</a>
					</li>
				</ul>
			</li> -->
			<li role="presentation" class="divider"></li>
			<li><a href="login.html"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Login Page</a></li>
		</ul>

	</div><!--/.sidebar-->
		
	<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">			
		<div class="row">
			<ol class="breadcrumb">
				<li><a href="#"><svg class="glyph stroked home"><use xlink:href="#stroked-home"></use></svg></a></li>
				<li class="active">Dashboard</li>
			</ol>
		</div><!--/.row-->		
		<div class="row">			
			<div id="container2">	
				<h2><b><span id='airlineName_ID' ></span></b></h2>
			</div>
		</div><!--/.row-->
		<div class="row">
			<div id="dashboard">
				<table id="tableDashboard">
					 <tr>
						<th>Date of Booking</th> 
						<th>Flight Number</th>
						<th>Origin</th>
						<th>Destination</th>
						<th>Name</th>
						<th>COF</th>					
						<th>Total Bid Amount</th>					
					  </tr>
				</table>
			</div> 
		</div>	
	</div><!--/.main container-->
</body>
	<script>
		firstBy=(function(){function e(f){f.thenBy=t;return f}function t(y,x){x=this;return e(function(a,b){return x(a,b)||y(a,b)})}return e})();
		var flight_array = [];
		var arrayBookingsTemp = [];
		var userDetails = [];
		var asyncFlag = false;
		var ctr=0;
		var maxcount2 = 0;
		var ctr2=0;
		var sort_by = function(field, reverse, primer){
				var key = function (x) {return primer ? primer(x[field]) : x[field]};

				return function (a,b) {
					var A = key(a), B = key(b);
					return ( (A < B) ? -1 : ((A > B) ? 1 : 0) ) * [-1,1][+!!reverse];                  
				}
			}
		urlEndPoint2 = baseURL+"/_ah/api/endpoint/v1/admin/bookings/"+baseToken;
		//urlEndPoint2 = "https://staging-mycape-webservice.appspot.com/_ah/api/endpoint/v1/admin/flights/"+flight_id_key+"/bookings/tokenToNgAnonymousCapeWagKaNaPumalagTokaNaTo!12518237jajsdiajdijioj9128391248hajkhasjkdkajshd";
			//console.log(urlEndPoint2);
			$.getJSON(urlEndPoint2, function(data){
				
			}).done(function(data){ 
				var maxcount = data.count;
				for (i = 0; i < maxcount; i++) { 
					flight_number = data.results[i].flight.flightNumber;
					flight_ID =  data.results[i].flight.flightId;
					airlineCode =  data.results[i].flight.airlineCode;
					departureDate = data.results[i].flight.departureDate;
					origin=data.results[i].flight.airportOriginCode;
					destination=data.results[i].flight.airportDestinationCode;
					status=data.results[i].flight.status;
					name=data.results[i].account.user.name;
					bidStatus = data.results[i].status;
					bidPrice = data.results[i].bid.bidPrice;
					if(bidStatus=='CANCELED' || bidStatus=='BUMPED_OFF'){
						cof=999;
					}
					else if(bidStatus=='CONFIRMED'){
						cof=100;
						bidPrice = data.results[i].paymentTransaction.amount;
					}
					else{
						cof = data.results[i].bid.chanceToFly;
					}
					
					bidPrice = bidPrice.toFixed(0);
					userDetails[i]={adepartureDate:departureDate,aflight_number:flight_number,aorigin:origin,adestination:destination,aflight_ID:flight_ID,aname:name,acof:cof,abidPrice:bidPrice,abidStatus:bidStatus};
				}//end if I

				userDetails.sort(sort_by('adepartureDate', false, parseInt));
				console.log(userDetails.length);
				console.log("POST SORTING")
				for (ctr2 = 0; ctr2 < userDetails.length; ctr2++) {					
						urlEndPoint3 = "https://staging-mycape-webservice.appspot.com/_ah/api/endpoint/v1/admin/flights/"+userDetails[ctr2].aflight_ID+"/bookings/tokenToNgAnonymousCapeWagKaNaPumalagTokaNaTo!12518237jajsdiajdijioj9128391248hajkhasjkdkajshd";
						 
						if(status=="closed" && userDetails[ctr2].acof=="999"){
							position = "BUMPED OFF";
							cofPosition = position;						
						}
						else if(status=="closed" && userDetails[ctr2].acof!="999"){
							position = "CONFIRMED";
							cofPosition = position;
							$('<tr/>[0]').append($('<td/>[0]').text(userDetails[ctr2].adepartureDate),$('<td/>[0]').text(userDetails[ctr2].aflight_number),$('<td/>[0]').text(userDetails[ctr2].aorigin),$('<td/>[0]').text(userDetails[ctr2].adestination),$('<td/>[0]').text(userDetails[ctr2].aname),$('<td/>[0]').text(cofPosition),$('<td/>[0]').text('$ ' +userDetails[ctr2].abidPrice)).appendTo($('#tableDashboard'));
						}
						else if((status=="CONFIRMED" || status=="ACTIVE") && userDetails[ctr2].acof=="999"){
							//console.log(userDetails[ctr2].abidStatus);
							if(userDetails[ctr2].abidStatus=="CANCELED"){
								position = "CANCELED";
							}
							else{
								position = "BUMPED_OFF";
							}
							cofPosition = position;
							//$('<tr/>[0]').append($('<td/>[0]').text(userDetails[ctr2].adepartureDate),$('<td/>[0]').append( "<a href="+urlEndPoint3+" target='_blank'>"+userDetails[ctr2].aflight_number+"</a>" ).attr("target", "_blank"),$('<td/>[0]').text(userDetails[ctr2].aorigin),$('<td/>[0]').text(userDetails[ctr2].adestination),$('<td/>[0]').text(userDetails[ctr2].aname),$('<td/>[0]').text(cofPosition),$('<td/>[0]').text('N/A')).appendTo($('#tableDashboard'));
						}
						else if((status=="CONFIRMED" || status=="ACTIVE") && userDetails[ctr2].acof=="100"){
							position = "CONFIRMED";
							cofPosition = position;
							$('<tr/>[0]').append($('<td/>[0]').text(userDetails[ctr2].adepartureDate),$('<td/>[0]').append( "<a href="+urlEndPoint3+" target='_blank'>"+userDetails[ctr2].aflight_number+"</a>" ).attr("target", "_blank"),$('<td/>[0]').text(userDetails[ctr2].aorigin),$('<td/>[0]').text(userDetails[ctr2].adestination),$('<td/>[0]').text(userDetails[ctr2].aname),$('<td/>[0]').text(cofPosition),$('<td/>[0]').text('$ ' +userDetails[ctr2].abidPrice)).appendTo($('#tableDashboard'));
						}
						else{															
							//console.log("STATUS: " + status +" NAME: " +userDetails[ctr2].aname);
							cofPosition = userDetails[ctr2].acof + '  %';
							$('<tr/>[0]').append($('<td/>[0]').text(userDetails[ctr2].adepartureDate),$('<td/>[0]').append( "<a href="+urlEndPoint3+" target='_blank'>"+userDetails[ctr2].aflight_number+"</a>" ).attr("target", "_blank"),$('<td/>[0]').text(userDetails[ctr2].aorigin),$('<td/>[0]').text(userDetails[ctr2].adestination),$('<td/>[0]').text(userDetails[ctr2].aname),$('<td/>[0]').text(cofPosition),$('<td/>[0]').text('$ ' +userDetails[ctr2].abidPrice)).appendTo($('#tableDashboard'));
						}
																																
					}//end if CTR2
				
			});//end done get URL
			
				
			
		
	</script>	
	<script src="js/bootstrap-table.js"></script>
</html>